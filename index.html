<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raspa y Gana ‚Äî El Chiflido</title>
  <meta name="description" content="Raspa, revela tu premio y canj√©alo por WhatsApp.">

  <!-- Preload de la fuente desde tu dominio -->
  <link rel="preload" href="https://descuentos.elchiflido.mx/fonts/Sink-Regular.woff?v=2" as="font" type="font/woff" crossorigin>

  <!-- Montserrat para textos secundarios -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* Fuente Sink */
    @font-face {
      font-family: 'Sink';
      src: url('https://descuentos.elchiflido.mx/fonts/Sink-Regular.woff?v=2') format('woff');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --sink: 'Sink', Georgia, Cambria, 'Times New Roman', serif;
      --mont: 'Montserrat', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      --blue: #3f51b5;
      --red:  #d32f2f;
      --yellow: #f4c400;
      --green: #25D366;
    }

    *{ box-sizing: border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sink);
      background: linear-gradient(135deg, #FFE9E6 0%, #FFF7CC 45%, #E6FFF7 100%);
      color:#111;
    }
    .wrap{ max-width:760px; margin:0 auto; padding:24px 16px 44px; }

    .title{
      margin:0; text-align:center; color:var(--red);
      text-transform:uppercase; letter-spacing:.5px; font-weight:900;
      font-size:clamp(28px,7vw,48px); line-height:1.05;
    }
    .logo{ display:block; margin:12px auto 0; height:clamp(56px,12vw,84px); filter:drop-shadow(0 3px 0 #2dd4bf); }
    .lead{
      margin:16px auto 0; text-align:center; color:var(--blue);
      font-weight:600; font-size:clamp(20px,6vw,36px); line-height:1.25; max-width:42ch;
    }

    /* Recuadro cuadrado */
    .card{ margin:20px auto 0; width:min(90vw, 320px); aspect-ratio:1/1; border-radius:14px;
           border:1px solid #e5e7eb; overflow:hidden; position:relative; background:var(--yellow);
           box-shadow:0 8px 22px rgba(0,0,0,.08); }
    @media (min-width: 640px){
      .card{ width:min(86vw, 360px); }
    }

    .reveal{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:16px; }
    .reveal .t1{ font-weight:900; font-size:clamp(22px,6.2vw,38px); }
    .reveal .t2{ opacity:.95; margin-top:8px; font-size:clamp(15px,4.8vw,22px); font-weight:600; }
    .code-chip{ margin-top:14px; display:inline-flex; gap:10px; align-items:center; background:rgba(255,255,255,.96);
                border:1px solid #e5e7eb; border-radius:999px; padding:8px 14px;
                font-family: ui-monospace, monospace;
                font-weight:800; font-size:clamp(13px,4.6vw,18px); box-shadow:0 4px 10px rgba(0,0,0,.06); }

    canvas.scratch{ position:absolute; inset:0; }

    .cta{
      display:block; margin:24px auto 0; width:min(92vw, 26rem);
      padding:14px 20px; border-radius:999px; border:0; background:var(--green); color:#fff;
      font-weight:900; letter-spacing:.4px; font-size:clamp(16px,4.8vw,22px);
      box-shadow:0 12px 26px rgba(37,211,102,.30); cursor:pointer;
      transition:transform .18s ease, opacity .18s ease;
    }
    .cta:active{ transform:scale(.98); } .cta:disabled{ opacity:.6; cursor:not-allowed; }

    .help{ margin:18px auto 0; width:min(92vw, 640px); border:1px solid #b91c1c; background:#dc2626; color:#fff; border-radius:16px; padding:12px 14px; text-align:center; box-shadow:0 10px 20px rgba(220,38,38,.18); font-family:var(--mont); }
    .help h3{ margin:4px 0 6px; font-size:clamp(22px,6vw,36px); font-family: var(--sink); font-weight: 400; }
    .help p{ margin:4px 0; font-size:clamp(16px,4.6vw,22px); }

    .socials{ margin:26px auto 0; display:flex; justify-content:center; gap:14px; }
    .socials a{ width:44px; height:44px; display:grid; place-items:center; background:#fff; border:1px solid #e5e7eb; border-radius:999px; box-shadow:0 6px 16px rgba(0,0,0,.08); }
    .ig{ color:#E1306C; } .fb{ color:#1877F2; } .tt{ color:#000; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">Raspa y Gana</h1>
    <img class="logo" src="https://cracks.agency/wp-content/uploads/2025/03/logo-chiflido.png" alt="El Chiflido">

    <p class="lead">Raspa y descubre el regalo que tenemos para ti</p>

    <section class="card" id="card">
      <div class="reveal">
        <div class="t1" id="pv-title">...</div>
        <div class="t2" id="pv-desc">...</div>
        <div class="code-chip"><span style="color:var(--blue);font-weight:800">C√≥digo</span> <span id="pv-code"></span></div>
      </div>
      <canvas id="cover" class="scratch"></canvas>
    </section>

    <button id="cta" class="cta" disabled>PRESIONA AQU√ç Y RECLAMA EL PREMIO</button>

    <div class="help" role="note">
      <h3>üéâ ¬°CANJEA TU PREMIO!</h3>
      <p>Presiona el <strong>bot√≥n verde</strong>, te llevamos a WhatsApp.</p>
      <p><strong>Escribe el c√≥digo en un mensaje</strong> y ¬°listo!</p>
    </div>

    <nav class="socials">
      <a class="ig" href="https://www.instagram.com/elchiflido_mx/" target="_blank" rel="noopener">IG</a>
      <a class="tt" href="https://www.tiktok.com/@elchiflido_mx" target="_blank" rel="noopener">TT</a>
      <a class="fb" href="https://www.facebook.com/elchiflldomx" target="_blank" rel="noopener">FB</a>
    </nav>
  </div>

  <script>
    const PRIZES = [
      { title: "Jamaica gratis", desc: "Recibe una jamaica gratis por una compra superior a $8.", code: "PROMO1202", prob: 25 },
      { title: "¬°Hoy todos tus tacos a $1!", desc: "Aplica para ti y tu acompa√±ante, sin importar el d√≠a.", code: "PROMO2203", prob: 20 },
      { title: "2 Flautas + 2 Bebidas por $12", desc: "Ll√©valo presentando tu c√≥digo al pagar.", code: "PROMO3204", prob: 18 },
      { title: "2 √ìrdenes de birria + bebida por $14", desc: "Disfr√∫talo en local.", code: "PROMO4205", prob: 15 },
      { title: "Mini marquesita GRATIS", desc: "Por compra de 2 platos + 2 bebidas.", code: "PROMO5206", prob: 12 },
      { title: "2 Chilaquiles + bebida por $14", desc: "Elige tu bebida disponible.", code: "PROMO6207", prob: 10 },
    ];

    function pickPrize(list){
      const roll = Math.random() * 100; let acc = 0;
      for (const p of list){ acc += p.prob; if (roll <= acc) return p; }
      return list[Math.floor(Math.random()*list.length)];
    }

    const canvas = document.getElementById('cover');
    const card   = document.getElementById('card');
    const ctx    = canvas.getContext('2d', { willReadFrequently: true });
    const CTA    = document.getElementById('cta');
    const pvTitle= document.getElementById('pv-title');
    const pvDesc = document.getElementById('pv-desc');
    const pvCode = document.getElementById('pv-code');
    const WA_BASE = "https://api.whatsapp.com/send?phone=593979342895&text=Hola%20quiero%20reclamar%20mi%20c√≥digo:%20";

    let drawing = false; let prize = null; let persistUntil = 0;

    function setupPrize(){
      prize = pickPrize(PRIZES);
      pvTitle.textContent = prize.title;
      pvDesc.textContent = prize.desc;
      pvCode.textContent = prize.code;
    }

    function setupCanvas(){
      const rect = card.getBoundingClientRect();
      const size = Math.floor(rect.width);
      const dpr  = Math.max(1, window.devicePixelRatio || 1);
      canvas.width  = Math.floor(size * dpr);
      canvas.height = Math.floor(size * dpr);
      canvas.style.width  = size + "px";
      canvas.style.height = size + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#000'; ctx.fillRect(0,0,size,size);

      const fam = "Sink, Georgia, Cambria, 'Times New Roman', serif";
      ctx.fillStyle = 'rgba(255,255,255,0.97)';
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.font = `800 ${Math.floor(size*0.10)}px ${fam}`;
      ctx.fillText("Raspa aqu√≠ para", size/2, size/2 - 20);
      ctx.fillText("descubrir tu premio", size/2, size/2 + 20);

      ctx.globalCompositeOperation = 'destination-out';
      CTA.disabled = true;
    }

    function getPos(e){
      const r = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) return { x: e.touches[0].clientX - r.left, y: e.touches[0].clientY - r.top };
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }

    function scratch(x,y){ ctx.beginPath(); ctx.arc(x, y, 22, 0, Math.PI*2); ctx.fill(); }

    function onStart(e){ e.preventDefault(); drawing = true; if(Date.now()>persistUntil){ persistUntil = Date.now()+4*60*1000; } const p=getPos(e); scratch(p.x,p.y); }
    function onMove(e){ if(!drawing) return; e.preventDefault(); const p=getPos(e); scratch(p.x,p.y); }
    function onEnd(){ drawing = false; checkProgress(); }

    function checkProgress(){
      const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let cleared = 0;
      for (let i=3; i<data.length; i+=4) if (data[i]===0) cleared++;
      if ((cleared / (data.length/4)) * 100 >= 55) CTA.disabled = false;
    }

    function openWhatsApp(){ if(!prize) return; window.open(WA_BASE + encodeURIComponent(prize.code), "_blank"); }
    CTA.addEventListener('click', openWhatsApp);

    canvas.addEventListener('mousedown', onStart);
    canvas.addEventListener('mousemove', onMove);
    canvas.addEventListener('mouseup', onEnd);
    canvas.addEventListener('touchstart', onStart, { passive:false });
    canvas.addEventListener('touchmove', onMove, { passive:false });
    canvas.addEventListener('touchend', onEnd);

    setupPrize(); setupCanvas();
  </script>
</body>
</html>
