<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Raspa y Gana ‚Äî El Chiflido</title>
  <meta name="description" content="Raspa, revela tu premio y canj√©alo por WhatsApp.">

  <!-- Preload de la fuente Sink -->
  <link rel="preload" href="fonts/Sink-Regular.woff" as="font" type="font/woff" crossorigin>

  <!-- Montserrat para textos secundarios -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    /* Fuente Sink */
    @font-face {
      font-family: 'Sink';
      src: url('fonts/Sink-Regular.woff') format('woff');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root {
      --sink: 'Sink', Georgia, Cambria, 'Times New Roman', serif;
      --mont: 'Montserrat', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
      --blue: #3f51b5;
      --red: #d32f2f;
      --yellow: #f4c400;
      --green: #25D366;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: var(--sink);
      background: linear-gradient(135deg, #FFE9E6 0%, #FFF7CC 45%, #E6FFF7 100%);
      color: #111;
    }
    .wrap { max-width: 760px; margin: 0 auto; padding: 24px 16px 44px; }

    .title {
      margin: 0;
      text-align: center;
      color: var(--red);
      text-transform: uppercase;
      font-weight: 900;
      font-size: clamp(28px, 7vw, 48px);
    }
    .logo {
      display: block;
      margin: 12px auto 0;
      height: clamp(56px, 12vw, 84px);
      filter: drop-shadow(0 3px 0 #2dd4bf);
    }
    .lead {
      margin: 16px auto 0;
      text-align: center;
      color: var(--blue);
      font-weight: 600;
      font-size: clamp(20px, 6vw, 36px);
      max-width: 42ch;
    }

    .card {
      margin: 20px auto 0;
      width: min(90vw, 320px);
      aspect-ratio: 1/1;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      position: relative;
      background: var(--yellow);
      box-shadow: 0 8px 22px rgba(0,0,0,.08);
    }
    @media (min-width: 640px) {
      .card { width: min(86vw, 360px); }
    }

    .reveal {
      position: absolute; inset: 0;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: 16px;
    }
    .reveal .t1 { font-weight: 900; font-size: clamp(22px, 6vw, 38px); }
    .reveal .t2 { margin-top: 8px; font-size: clamp(15px, 5vw, 22px); font-weight: 600; }
    .code-chip {
      margin-top: 14px; display: inline-flex; gap: 10px; align-items: center;
      background: rgba(255,255,255,.96);
      border: 1px solid #e5e7eb;
      border-radius: 999px;
      padding: 8px 14px;
      font-family: ui-monospace, monospace;
      font-weight: 800; font-size: clamp(13px, 5vw, 18px);
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
    }

    canvas.scratch { position: absolute; inset: 0; }

    .cta {
      display: block; margin: 24px auto 0;
      width: min(92vw, 26rem);
      padding: 14px 20px;
      border-radius: 999px;
      background: var(--green); color: #fff; border: none;
      font-weight: 900;
      font-size: clamp(16px, 5vw, 22px);
      box-shadow: 0 12px 26px rgba(37,211,102,.3);
      cursor: pointer;
    }
    .cta:disabled { opacity: .6; cursor: not-allowed; }

    .help {
      margin: 18px auto 0;
      width: min(92vw, 640px);
      border: 1px solid #b91c1c;
      background: #dc2626;
      color: #fff;
      border-radius: 16px;
      padding: 12px 14px;
      text-align: center;
      font-family: var(--mont);
    }
    .help h3 {
      margin: 4px 0 6px;
      font-size: clamp(20px, 6vw, 32px);
      font-family: var(--sink);
    }
    .help p { margin: 4px 0; font-size: clamp(16px, 5vw, 22px); }

    .socials {
      margin: 26px auto 0;
      display: flex; justify-content: center; gap: 14px;
    }
    .socials a {
      width: 44px; height: 44px;
      display: grid; place-items: center;
      background: #fff;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 6px 16px rgba(0,0,0,.08);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">Raspa y Gana</h1>
    <img class="logo" src="https://cracks.agency/wp-content/uploads/2025/03/logo-chiflido.png" alt="El Chiflido">
    <p class="lead">Raspa y descubre el regalo que tenemos para ti</p>

    <section class="card" id="card">
      <div class="reveal">
        <div class="t1" id="pv-title">...</div>
        <div class="t2" id="pv-desc">...</div>
        <div class="code-chip"><span style="color:var(--blue)">C√≥digo</span> <span id="pv-code"></span></div>
      </div>
      <canvas id="cover" class="scratch"></canvas>
    </section>

    <button id="cta" class="cta" disabled>PRESIONA AQU√ç Y RECLAMA EL PREMIO</button>

    <div class="help">
      <h3>üéâ ¬°CANJEA TU PREMIO!</h3>
      <p>Presiona el <b>bot√≥n verde</b>, te llevamos a WhatsApp.</p>
      <p><b>Escribe el c√≥digo en un mensaje</b> y ¬°listo!</p>
    </div>

    <nav class="socials">
      <a href="https://www.instagram.com/elchiflido_mx/" target="_blank">IG</a>
      <a href="https://www.tiktok.com/@elchiflido_mx" target="_blank">TT</a>
      <a href="https://www.facebook.com/elchiflldomx" target="_blank">FB</a>
    </nav>
  </div>

  <script>
    const PRIZES = [
      { title: "Jamaica gratis", desc: "Recibe una jamaica gratis por una compra superior a $8.", code: "PROMO1202", prob: 25 },
      { title: "¬°Hoy todos tus tacos a $1!", desc: "Aplica para ti y tu acompa√±ante.", code: "PROMO2203", prob: 20 },
      { title: "2 Flautas + 2 Bebidas por $12", desc: "Aplica para servirse en el local.", code: "PROMO3204", prob: 18 },
      { title: "2 √ìrdenes de birria + bebida por $14", desc: "Aplica para servirse en el local.", code: "PROMO4205", prob: 15 },
      { title: "Mini marquesita GRATIS", desc: "Por compra de 2 platos + 2 bebidas.", code: "PROMO5206", prob: 12 },
      { title: "2 Chilaquiles + bebida por $14", desc: "Aplica para servirse en el local.", code: "PROMO6207", prob: 10 },
    ];

    function pickPrize(list){
      const roll = Math.random() * 100; let acc = 0;
      for (const p of list){ acc += p.prob; if (roll <= acc) return p; }
      return list[Math.floor(Math.random()*list.length)];
    }

    const canvas = document.getElementById('cover');
    const card   = document.getElementById('card');
    const ctx    = canvas.getContext('2d');
    const CTA    = document.getElementById('cta');
    const pvTitle= document.getElementById('pv-title');
    const pvDesc = document.getElementById('pv-desc');
    const pvCode = document.getElementById('pv-code');

    const WA_BASE = "https://api.whatsapp.com/send?phone=593979342895&text=Hola,%20mi%20c√≥digo%20es:%20";

    let drawing = false; let prize = null;
    let persistUntil = 0; let lastWidth = 0;

    async function ensureSinkLoaded() {
      try {
        if (!document.fonts) return;
        await document.fonts.load("400 24px 'Sink'");
        await document.fonts.ready;
      } catch(_) {}
    }

    function setupPrize(){
      prize = pickPrize(PRIZES);
      pvTitle.textContent = prize.title;
      pvDesc.textContent  = prize.desc;
      pvCode.textContent  = prize.code;
    }

    function setupCanvas(){
      const rect = card.getBoundingClientRect();
      const size = Math.floor(rect.width);
      const dpr  = window.devicePixelRatio || 1;
      canvas.width  = Math.floor(size * dpr);
      canvas.height = Math.floor(size * dpr);
      canvas.style.width  = size + "px";
      canvas.style.height = size + "px";
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      lastWidth = size;

      ctx.globalCompositeOperation = 'source-over';
      ctx.fillStyle = '#000'; ctx.fillRect(0,0,size,size);

      const FACE = "'Sink', Georgia, Cambria, 'Times New Roman', serif";
      const line1 = "Raspa aqu√≠ para";
      const line2 = "descubrir tu premio";
      let fontSize = Math.min(34, Math.max(14, Math.floor(size * 0.10)));
      ctx.fillStyle = 'rgba(255,255,255,0.97)';
      ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
      ctx.font = `800 ${fontSize}px ${FACE}`;
      const lh = Math.floor(fontSize * 1.25);
      ctx.fillText(line1, size/2, size/2 - lh/2);
      ctx.fillText(line2, size/2, size/2 + lh/2);

      ctx.globalCompositeOperation = 'destination-out';
      CTA.disabled = true;
    }

    function getPos(e){
      const r = canvas.getBoundingClientRect();
      if (e.touches && e.touches[0]) { const t = e.touches[0]; return { x: t.clientX - r.left, y: t.clientY - r.top }; }
      return { x: e.clientX - r.left, y: e.clientY - r.top };
    }
    function scratch(x,y){ ctx.beginPath(); ctx.arc(x, y, 22, 0, Math.PI*2); ctx.fill(); }

    function onStart(e){ e.preventDefault(); drawing = true; if(Date.now() > persistUntil){ persistUntil = Date.now() + 4*60*1000; } const p = getPos(e); scratch(p.x,p.y); }
    function onMove(e){ if(!drawing) return; e.preventDefault(); const p = getPos(e); scratch(p.x,p.y); }
    function onEnd(){ drawing = false; checkProgress(); }

    function checkProgress(){
      const data = ctx.getImageData(0,0,canvas.width,canvas.height).data;
      let cleared = 0;
      for (let i=3; i<data.length; i+=4) if (data[i] === 0) cleared++;
      const pct = cleared / (data.length/4) * 100;
      if (pct >= 55) CTA.disabled = false;
    }

    function openWhatsApp(){ if(!prize) return; window.open(WA_BASE + prize.code, "_blank"); }
    CTA.addEventListener('click', openWhatsApp);

    canvas.addEventListener('mousedown', onStart);
    canvas.addEventListener('mousemove', onMove);
    canvas.addEventListener('mouseup', onEnd);
    canvas.addEventListener('touchstart', onStart, { passive:false });
    canvas.addEventListener('touchmove', onMove, { passive:false });
    canvas.addEventListener('touchend', onEnd);

    async function init(){
      setupPrize();
      await ensureSinkLoaded();
      setupCanvas();
    }
    init();
  </script>
</body>
</html>
